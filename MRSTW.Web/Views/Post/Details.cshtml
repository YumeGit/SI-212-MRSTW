@model MRSTW.Domain.Entities.Post
@using MRSTW.Web.Extensions

@{
ViewBag.Title = Model.Name;
}

@section Styles
{
<link rel="stylesheet" href="~/Content/styles/Post.css" />
}

<div class="post_thumb">
    <div class="post_thumb_inner">
        <img src="@Model.Thumbnail" />
    </div>
</div>


<h1>@Model.Name</h1>
<div>
    <small>
        By @Model.Author.Name -
        from @Model.Created.ToShortDateString()
    </small>
</div>

@if (Session.UserHasRole(MRSTW.Domain.Entities.UserRole.Admin))
{
    <div>
        <small>
            <a href="@Url.Action("Edit", "Post", new { id = Model.Id })">[Редактировать]</a>
            <a href="@Url.Action("Delete", "Post", new { id = Model.Id })">[Удалить]</a>
        </small>
    </div>
}

<div class="post_content">
    @Model.Story
</div>

<div class="react_container">
    @{
        var emojis = Model.Reactions.GroupBy(x => x.Emoji);
    }

    @foreach (var emoji in emojis)
    {
        <div class="react">
            <div class="reactors">
                @string.Join(", ", emoji.Select(x => x.User.Name)) reacted with @Html.Raw(@emoji.Key)
            </div>
            @Html.Raw(@emoji.Key) @emoji.Count()
        </div>
    }
</div>

<div>
    @Html.ActionLink($"[ {Model.Comments.Count} Comments ]", "Comments", new { id = Model.Id })
</div>
